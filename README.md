# s3-malware-scanner
Uses VirusTotal to scan S3 files as they get populated into buckets

## Basic Workflow
<p align="center">
  <img src="https://res.cloudinary.com/dj7k0lade/image/upload/v1582625704/github/s3-malware-scanner.png" alt="S3 Malware Scanner Architecture" />
</p>
</br>

* A lambda trigger is applied to any S3 Post/Put that gets added to a specified bucket
* A lambda function is used to query the VirusTotal API and retrieve a scan URL
* The scan URL is added to an SQS scan queue to query the results of this scan at a later interval
* The SQS scan queue triggers a lambda function that queries VirusTotal to gather the resulting scan report
* Any suspicious files are added to an SQS quarantine queue for future deletion

## Getting Started
These instructions will get you a copy of the project up and running on your AWS account.

### Lambda Functions
S3 Malware Scanner works off a number of lambda functions that are available in the build directory of the application, the lambda function zips should respectively be added to a bucket specified by the **S3MalwareLambdaBucketNameParameter** upon the creation of the CloudFormation stack.  

### Deployment via CloudFormation
```
aws --region eu-west-1 cloudformation create-stack --capabilities CAPABILITY_NAMED_IAM --stack-name totalvirus-stack --template-body file://initialize.json --parameters ParameterKey=S3MalwareUploadBucketNameParameter,ParameterValue=${SOURCE_BUCKET_NAME} ParameterKey=S3MalwareLambdaBucketNameParameter,ParameterValue=${LAMBDA_BUCKET_NAME} ParameterKey=TotalVirusApiKeyParameter,ParameterValue=${TOTALVIRUS_API_KEY}
```

## Dependencies
* request
* dotenv

## Author
* Lewis Alberto Briffa
