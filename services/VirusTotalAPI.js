/* ===============================================================
/* Virus Total - API Library
/* @description   Makes requests to the VirusTotal API to query the
/*                state of a given file or URL.
/* @author        Lewis Briffa
/* =============================================================== */

'use strict';

// Dependencies
const request = require('request');
const fs = require('fs');

module.exports = class VirusTotalAPI {
	constructor(params) {
		this.BASE_PATH = 'https://www.virustotal.com/vtapi/v2';

		if ('apiKey' in params) {
			this.apiKey = params.apiKey;
		}
	}

	/**
	 * Allows you to send a file for scanning with VirusTotal. Max File Size => 32MB
	 * 
	 * @param      A base64 representation of the file
	 * @returns    Success: A TotalVirus API response providing the scan ID for a future request
	 *             Error: The detailed error response received from TotalVirus
	 */
	fileScan(base64File) {
		return new Promise((resolve, reject) => {
			request.post({ url: `${this.BASE_PATH}/file/scan`, form: { apikey: this.apiKey, file: base64File } },
				(err, resp, body) => { err ? reject(err) : resolve(body) });
		});
	}

	/**
	 * Allows you to retrieve the file scan reports based on a given Scan ID
	 * 
	 * @param      A scan ID representing the report resource requested
	 * @returns    Success: A TotalVirus API response providing the complete report of the scanned item
	 *             Error: The detailed error response received from TotalVirus
	 */
	fileReport(scanId) {
		return new Promise((resolve, reject) => {
			request({ url: `${this.BASE_PATH}/file/report`, qs: { apikey: this.apiKey, resource: scanId } },
				(err, resp, body) => { err ? reject(err) : resolve(body) });
		});
	}
}