'use strict';

const StorageService = require('./StorageService');
const fs = require('fs');
const s3GetObjectResponse = JSON.parse(fs.readFileSync(`${__dirname}/mockResponses/s3/getObjectResponse.json`));

module.exports = class MockS3StorageService extends StorageService {
	constructor() {
		super();
	}

	getFile(params, callback) {
		let errors = [];

		// Handle required S3 parameters
		if (!("Bucket" in params) || params.Bucket === "") {
			errors.push(`MissingRequiredParameter: Missing required key 'Bucket' in params`);
		}
		if (!("Key" in params) || params.Key === "") {
			errors.push(`MissingRequiredParameter: Missing required key 'Key' in params`);
		}

		// Create a buffer object from the body reponse buffer
		const buffer = Buffer.from(s3GetObjectResponse.Body);
		s3GetObjectResponse.Body = buffer;
		callback(errors.join(`\n`), s3GetObjectResponse);
	}
};