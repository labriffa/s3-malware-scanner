// Virus Total - API Library
// @author Lewis Briffa
// ===============================================================

'use strict';

// Dependencies
const request = require('request');
const fs = require('fs');

module.exports = class VirusTotalAPI {
	constructor(params) {
		this.BASE_PATH = 'https://www.virustotal.com/vtapi/v2';

		if ('apiKey' in params) {
			this.apiKey = params.apiKey;
		}
	}

	/**
	 * Allows you to send a file for scanning with VirusTotal. Max File Size => 32MB
	 * 
	 * @param		The URI to a given file
	 * @returns		Success: A TotalVirus API response providing the scan ID for a future request
	 * 				Error: The detailed error response recieved from the TotalVirus API 
	 */
	fileScanFromUri(uri) {
		// Get a Base64 represenation of the file
		const base64 = fs.readFileSync(uri, 'base64');

		request.post({ url: `${this.BASE_PATH}/file/scan`, form: { apikey: this.apiKey, file: base64 } }, (err, resp, body) => {
			if (err) {
				return err;
			} else {
				return body;
			}
		});
	}
}