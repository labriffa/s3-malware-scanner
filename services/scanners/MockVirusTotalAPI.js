'use strict';

const VirusScanner = require('./VirusScanner');
const fs = require('fs');
const mockVirusScanResponse = fs.readFileSync(`${__dirname}/mockResponses/virusScanner/fileScanResponse.json`);
const mockVirusReportResponse = fs.readFileSync(`${__dirname}/mockResponses/virusScanner/fileReportResponse.json`);

/**
 * A mock VirusTotal API library that mimics VirusTotal responses for offline testing
 */
module.exports = class MockVirusTotalAPI extends VirusScanner {
	constructor() {
		super();
	}

	/**
	 * Checks for a base64 encoded file and provides the mock VirusTotal scan response
	 * 
	 * @param {*} file 
	 */
	fileScan(file) {
		return new Promise((resolve, reject) => {
			if (Buffer.from(file, 'base64').toString('base64') === file) {
				resolve(mockVirusScanResponse);
			} else {
				reject('Not a valid file format');
			}
		});
	}

	/**
	 * Checks for a scan id and provides the mock VirusTotal report response
	 * 
	 * @param {*} scanId 
	 */
	fileReport(scanId) {
		return new Promise((resolve, reject) => {
			if (scanId) {
				resolve(mockVirusReportResponse);
			} else {
				reject('No scan_id specified');
			}
		});
	}
}