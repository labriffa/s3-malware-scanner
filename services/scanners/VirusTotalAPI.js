'use strict';

const request = require('request');
const fs = require('fs');
const VirusScanner = require('./VirusScanner');

/**
 * A wrapper class for the VirusTotalAPI 
 */
module.exports = class VirusTotalAPI extends VirusScanner {
	constructor(params) {
		super();

		this.BASE_PATH = 'https://www.virustotal.com/vtapi/v2';

		if ('apiKey' in params) {
			this.apiKey = params.apiKey;
		}
	}

	/**
	 * Allows you to send a file for scanning with VirusTotal. Max File Size => 32MB
	 * 
	 * @param {*} base64File 
	 */
	fileScan(base64File) {
		return new Promise((resolve, reject) => {
			request.post({ url: `${this.BASE_PATH}/file/scan`, form: { apikey: this.apiKey, file: base64File } },
				(err, resp, body) => {
					if (err) {
						reject(err);
					} else {
						resolve(body);
					}
				});
		});
	}

	/**
	 * Allows you to retrieve a file scan report based on a given scan id
	 * 
	 * @param {*} scanId 
	 */
	fileReport(scanId) {
		return new Promise((resolve, reject) => {
			request({ url: `${this.BASE_PATH}/file/report`, qs: { apikey: this.apiKey, resource: scanId } },
				(err, resp, body) => {
					if (err) {
						reject(err);
					} else {
						resolve(body);
					}
				});
		});
	}
}